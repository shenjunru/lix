/*
 * LiX JavaScript CSS selector engine
 * Project since: 2009-02-18
 * Version: 1.0.5 build 20090723
 * 
 * Copyright (c) 2009 Shen Junru (XFSN)
 * Released under the MIT, BSD, and GPL Licenses.
*/
(function(){if(!document.nodeType){document.nodeType=9}var g=function(){this.prev=null;this.next=null;this.group=0;this.tag="*";this.id="";this.type="";this.feature={}},l={CHAR:/^\s*([>~+#*.:[,\w\u00c0-\uFFFF])/,GROUP:/^\s*,\s*/,TAG:/^\s*(\*|[\w\u00c0-\uFFFF-]+)/,ID:/^(\s*)#(\*|[\w\u00c0-\uFFFF-]+)/,FILTER:/^\s*([>~+])\s*(\*|[\w\u00c0-\uFFFF-]+)/,CLASS:/^(\s*)\.([\w\d\u00C0-\uFFFF-]+)/,PSEUDO:/^\s*:(\w[\w-]*)(?:\((?:(['"])(.+)\2|([^\)]+\(.+\))|([^\)]+))\))?/,ATTR:/^\s*\[\s*([\w\d]+)\s*(?:([!~$|*^]?=)\s*([\w\d\u00C0-\uFFFF.-]+|"([^"]*)"|'([^']*)')\s*)?\]/,NTH:/(-?)(\d*)n((?:\+|-)?\d*)/},r={},q=function(z,A){return A&&A instanceof SyntaxError?A:new SyntaxError("css parse error, char:"+z)},s=function(C,A){A=A||0;var K=[],F=0,E=0,B=C.length,z=true,D,J,H,I,G;while(E<B){D=C.slice(E,B),J=l.CHAR.exec(D);if(!J){throw q(A)}I=new g(),I._fragroup=F;switch(J[1]){case">":case"~":case"+":H=l.FILTER.exec(D);if(H){I.type=H[1],I.tag=H[2];if(G){G.next=I,I.prev=G}}break;case"#":H=l.ID.exec(D);if(H){if(!H[1]){I=G||I}I.type="#",I.id=H[2];if(H[1]&&G){G.next=I,I.prev=G}}break;case".":H=l.CLASS.exec(D);if(H){if(H[1]&&G){G.next=I,I.prev=G}else{I=G||I}p.CLASS(I,H,A)}break;case":":H=l.PSEUDO.exec(D);if(H){I=G||I,p.PSEUDO(I,H,A)}break;case"[":H=l.ATTR.exec(D);if(H){I=G||I,p.ATTR(I,H,A)}break;case",":H=l.GROUP.exec(D);if(H){z=true,F++,G=I=null}break;default:H=l.TAG.exec(D);if(H){I.tag=H[1];if(G){G.next=I,I.prev=G}}break}if(!H){throw q(A)}E+=H[0].length,A+=H[0].length;if(z&&(G||I)){K.push(G||I),z=false}G=I}return K},p={CLASS:function(B,z,A){B.feature["."]=B.feature["."]||[];B.feature["."].push(z[2])},PSEUDO:function(F,A,B){try{F.feature[":"]=F.feature[":"]||[];var z=A[1].toLowerCase(),C=A[5]||A[4]||A[3],E=i.PSEUDO[z];if(C&&E){C=E(C,z.length+B+2)}F.feature[":"].push({name:z,value:C})}catch(D){if(D!=r){throw q(B,D)}}},ATTR:function(G,A,B){try{G.feature["[]"]=G.feature["[]"]||[];var z=A[1],E=A[2]||"",C=A[5]||A[4]||A[3],F=i.ATTR[z];if(C&&F){C=F(E,C,B)}G.feature["[]"].push({name:z,expr:E,value:C,target:null})}catch(D){if(D!=r){throw q(B,D)}}}},i={PSEUDO:{not:function(z,A){return s(z,A)},"nth-child":function(A){if(/^\bn\b$/i.test(A)){throw r}var z=l.NTH.exec(A=="even"&&"2n"||A=="odd"&&"2n+1"||!/\D/.test(A)&&"0n+"+A||A);return{a:(z[1]+(z[2]||1))-0,b:z[3]-0}}},ATTR:{"class":function(A,z){if(!z){return z}switch(A){case"*=":return z;case"|=":case"^=":return" "+z;case"$=":return z+" ";default:return" "+z+" "}}}},v=window.LiX=function(B,D,A){D=[D||document];A?A.length==null&&(A.length=0):A=[];if(typeof(B)=="string"&&u(D[0])){try{d=0,y++;var z=s(B),C=0,F;while(F=z[C++]){e(A,F,D)}}catch(E){throw E}}return A},d=0,y=0,e=function(H,G,A){var C=G.next;if(C){var E=[],B=0;G.next=null;arguments.callee(E,G,A);E.lenght==0||arguments.callee(H,C,E);G.next=C}else{if(!A.length){A=document}var B=0,F,z=n(G,A);d++;try{while(F=z[B++]){if(F.nodeType){m[G.type](H,G,F)}}}catch(D){if(D!=r){throw D}}}return H},h=function(z,A){if(y!=A._lixIndex){A._lixIndex=y;Array.prototype.push.call(z,A)}},o=function(A,z){return A.tag=="*"?true:z.nodeName.toLowerCase()==A.tag.toLowerCase()},w=function(D,B,A){var C,z=true;for(C in D.feature){if(!z){break}z=x[C](B,D.feature[C],A)}return z},j={"class":"className","for":"htmlFor",id:"id"},b=function(z){return z.nodeType==9&&z.documentElement.nodeName!="HTML"||!!z.ownerDocument&&z.ownerDocument.documentElement.nodeName!="HTML"},u=function(z){return(z&&(z.nodeType==1||z.nodeType==9))},k=(function(){if(document.documentElement.compareDocumentPosition){return function(A,z){return(A.compareDocumentPosition(z)&16)==16}}if(document.documentElement.contains){return function(A,z){return A.contains(z)&&A!=z}}return function(A,z){while(z=z.parentNode){if(z==A){return true}}return false}})(),a=function(B){var A=0,z=B.parentNode,C=z.firstChild;if(d!=z._lixCache){for(;C;C=C.nextSibling){if(C.nodeType==1){C.nodeIndex=++A}}z._lixCache=d}return B.nodeIndex},n=function(E,C){var D,A,B=0,z=[];switch(E.type){case"~":while(D=C[B++]){if(D.nodeType){z.push(D);break}}while(A=D,D=C[B++]){if(k(A,D)){z.push(D)}}return z;case"":while(D=C[B++]){if(D.nodeType){z.push(D);break}}while(A=D,D=C[B++]){if(k(D,A)){z=[D]}else{if(!k(A,D)){z.push(D)}}}return z;default:return C}},c=function(A,z){if(z in j){return A[j[z]]}return A.getAttribute(z)},t=function(z,A){var B=c(A,z.name);switch(z.name){case"class":z.target=B?" "+B+" ":null;break;default:z.target=B}return z},m={"":function(z,E,C){var B=0,D,A=C.getElementsByTagName(E.tag)||[];while(D=A[B++]){if(w(E,D,null)){h(z,D)}}},"#":function(z,C,A){var B=(A.ownerDocument||document).getElementById(C.id);if(B&&B.getAttributeNode("id")&&o(C,B)&&w(C,B,null)){if(C.prev==null||k(A,B)){h(z,B)}throw r}},">":function(z,F,D){var C=0,A=1,E,B=D.childNodes||[];while(E=B[C++]){if(E.nodeType==1&&o(F,E)&&w(F,E,A++)){h(z,E)}}},"+":function(z,C,A){var B=A;while(B=B.nextSibling){if(B.nodeType==1){if(o(C,B)&&w(C,B,null)){h(z,B)}break}}},"~":function(z,C,A){var B=A;while(B=B.nextSibling){if(B.nodeType==1&&o(C,B)&&w(C,B,null)){h(z,B)}}}},x={":":function(D,E,B){var z=true,C=0,F;while(z&&(F=E[C++])){var A=f.PSEUDO[F.name];z=A?A(D,F.value,B):false}return z},".":function(D,E,A){if(!D.className){return false}var z=true,C=0,F,B=" "+D.className+" ";while(z&&(F=E[C++])){z=B.indexOf(F)>-1}return z},"[]":function(D,E,B){var A=true,C=0,z;while(A&&(z=E[C++])){z=t(z,D);A=f.ATTR[z.expr](z.target,z.value)}return A}},f={ATTR:{"":function(A,z){return !!A},"=":function(A,z){return A==z},"!=":function(A,z){return A!=z},"~=":function(A,z){return A?(" "+A+" ").indexOf(z)>=0:false},"^=":function(A,z){return A?A.indexOf(z)==0:false},"$=":function(A,z){return A?A.substr(A.length-z.length)==z:false},"*=":function(A,z){return A?A.indexOf(z)>=0:false},"|=":function(A,z){return A?A==z||A.substr(0,z.length+1)==z+"-":false}},PSEUDO:{input:function(z){return/input|select|textarea|button/i.test(z.nodeName)},button:function(z){return"button"==z.type||z.nodeName.toUpperCase()=="BUTTON"},checkbox:function(z){return"checkbox"==z.type},file:function(z){return"file"==z.type},image:function(z){return"image"==z.type},password:function(z){return"password"==z.type},radio:function(z){return"radio"==z.type},reset:function(z){return"reset"==z.type},submit:function(z){return"submit"==z.type},text:function(z){return"text"==z.type},enabled:function(z){return z.disabled==false&&z.type!="hidden"},disabled:function(z){return true},checked:function(z){return z.checked==true},selected:function(z){return z.selected==true},hidden:function(z){return z.offsetWidth==0||z.offsetHeight==0},visible:function(z){return z.offsetWidth>0||z.offsetHeight>0},empty:function(z){return !z.firstChild},parent:function(z){return !!z.firstChild},contains:function(z,A){return(z.textContent||z.innerText||"").indexOf(A)>=0},has:function(D,A,B){var C=0,E,z=true;while(z&&(E=A[C++])){z=!!(e([],E,[D]).length)}return z},"first-child":function(z){while((z=z.previousSibling)&&z.nodeType!=1){}return !z},"last-child":function(z){while((z=z.nextSibling)&&z.nodeType!=1){}return !z},"only-child":function(A){var z=A;while(z=z.previousSibling){if(z.nodeType==1){return false}}z=A;while(z=z.nextSibling){if(z.nodeType==1){return false}}return true},"nth-child":function(A,B,z){var C=(z||a(A))-B.b;if(B.a==0){return C==0}else{return(C%B.a==0&&C/B.a>=0)}},"gth-child":function(A,B,z){return B<(z||a(A))},"lth-child":function(A,B,z){return B>(z||a(A))},header:function(z){return/h\d/i.test(z.nodeName)},not:function(D,A,B){var C=0,E,z=true;while(z&&(E=A[C++])){z=!(o(E,D)&&w(E,D,B))}return z}}};i.PSEUDO.has=i.PSEUDO.not;v.parseSelector=s})();