/*
 * LiX JavaScript CSS selector engine
 * Project since: 2009-02-18
 * Version: 1.0.5.2 build 20090731
 * 
 * Copyright (c) 2009 Shen Junru (XFSN)
 * Released under the MIT, BSD, and GPL Licenses.
*/
(function(){if(!document.nodeType){document.nodeType=9}var k={CHAR:/^\s*([>~+#*.:[,\w\u00c0-\uFFFF])/,GROUP:/^\s*,\s*/,TAG:/^\s*(\*|[\w\u00c0-\uFFFF-]+)/,ID:/^(\s*)#([\w\u00c0-\uFFFF-]+)/,FILTER:/^\s*([>~+])\s*(\*|[\w\u00c0-\uFFFF-]+)/,CLASS:/^(\s*)\.([\w\d\u00C0-\uFFFF-]+)/,PSEUDO:/^\s*:([\w\u00c0-\uFFFF-]+)(?:\((?:(['"])(.+)\2|([^\)]+\(.+\))|([^\)]+))\))?/,ATTR:/^\s*\[\s*([\w\u00c0-\uFFFF-]+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3)?\s*\]/,NTH:/(-?)(\d*)n((?:\+|-)?\d*)/},o={},q={"class":"className","for":"htmlFor"},n=function(y,z){return z&&z instanceof SyntaxError?z:new SyntaxError("css parse error, char:"+y)},p=function(A,D){D=D||0;var J=[],y=true,F=A.replace(/\s*$/,""),B=0,C=0,z=F.length,I,G,H,E;while(B<z){F=A.slice(B,z),I=k.CHAR.exec(F);if(!I){throw n(D)}H={tag:"*",type:"",feature:{},group:C};switch(I[1]){case">":case"~":case"+":G=k.FILTER.exec(F);if(G){H.type=G[1],H.tag=G[2];if(E){E.next=H,H.prev=E}}break;case"#":G=k.ID.exec(F);if(G){if(!G[1]){H=E||H}H.type="#",H.id=G[2];if(G[1]&&E){E.next=H,H.prev=E}}break;case".":G=k.CLASS.exec(F);if(G){if(G[1]&&E){E.next=H,H.prev=E}else{H=E||H}m.CLASS(H,G,D)}break;case":":G=k.PSEUDO.exec(F);if(G){H=E||H,m.PSEUDO(H,G,D)}break;case"[":G=k.ATTR.exec(F);if(G){H=E||H,m.ATTR(H,G,D)}break;case",":G=k.GROUP.exec(F);if(G){y=true,C++,E=H=null}break;default:G=k.TAG.exec(F);if(G){H.tag=G[1];if(E){E.next=H,H.prev=E}}break}if(!G){throw n(D)}B+=G[0].length,D+=G[0].length;if(y&&(E||H)){J.push(E||H),y=false}E=H}return J},m={CLASS:function(A,y,z){A.feature["."]=A.feature["."]||[];A.feature["."].push(y[2])},PSEUDO:function(E,z,A){try{E.feature[":"]=E.feature[":"]||[];var y=z[1].toLowerCase(),B=z[5]||z[4]||z[3],D=i.PSEUDO[y];if(B&&D){B=D(B,y.length+A+2)}E.feature[":"].push({name:y,value:B})}catch(C){if(C!=o){throw n(A,C)}}},ATTR:function(F,z,A){try{F.feature["[]"]=F.feature["[]"]||[];var y=z[1],D=z[2]||"",B=z[4],E=i.ATTR[y];if(B&&E){B=E(D,B,A)}F.feature["[]"].push({name:q[y]||y,expr:D,value:B})}catch(C){if(C!=o){throw n(A,C)}}}},i={PSEUDO:{not:function(y,z){return p(y,z)},"nth-child":function(z){if(/^\bn\b$/i.test(z)){throw o}var y=k.NTH.exec(z=="even"&&"2n"||z=="odd"&&"2n+1"||!/\D/.test(z)&&"0n+"+z||z);return{a:(y[1]+(y[2]||1))-0,b:y[3]-0}}},ATTR:{"class":function(z,y){if(!y){return y}switch(z){case"*=":return y;case"|=":case"^=":return" "+y;case"$=":return y+" ";default:return" "+y+" "}}}},u=window.LiX=function(A,C,z){C=[C||document];z?z.length==null&&(z.length=0):z=[];if(typeof(A)=="string"&&s(C[0])){try{e=0,x++;var y=p(A),B=0,E;while(E=y[B++]){f(C,E,z)}}catch(D){throw D}}return z},e=0,x=0,f=function(B,A,G){var D=A.next;if(D){A.next=null;var F=arguments.callee(B,A,[]);F.lenght||arguments.callee(F,D,G);A.next=D}else{e++;var B=t(B,A),z=A.tag=="*"||A.type=="",C=0,y;try{while(y=B[C++]){if(y.nodeType){l[A.type](y,A,G||[],z)}}}catch(E){if(E!=o){throw E}}}return G},h=function(y,z){if(x!=z._lixIndex){z._lixIndex=x;Array.prototype.push.call(y,z)}},d=function(z,y){return z.nodeName.toLowerCase()==y.tag.toLowerCase()},v=function(C,z,B,A){var y=B||d(C,z),D;for(D in z.feature){if(!y){break}y=w[D](C,z.feature[D],A)}return y},s=function(y){return(y&&(y.nodeType==1||y.nodeType==9))},b=function(y){return y.nodeType==9&&y.documentElement.nodeName!="HTML"||!!y.ownerDocument&&y.ownerDocument.documentElement.nodeName!="HTML"},j=(function(){if(document.documentElement.compareDocumentPosition){return function(z,y){return(z.compareDocumentPosition(y)&16)==16}}if(document.documentElement.contains){return function(z,y){return z.contains(y)&&z!=y}}return function(z,y){while(y=y.parentNode){if(y==z){return true}}return false}})(),t=function(D,z){var C,A,B=0,y=[];switch(z.type){case"~":while(C=D[B++]){if(C.nodeType){y.push(C);break}}while(A=C,C=D[B++]){if(j(A,C)){y.push(C)}}return y;case"":while(C=D[B++]){if(C.nodeType){y.push(C);break}}while(A=C,C=D[B++]){if(j(C,A)){y=[C]}else{if(!j(A,C)){y.push(C)}}}return y;default:return D}},r={href:function(y){return y.getAttribute("href",2)},src:function(y){return y.getAttribute("src",2)},className:function(y){var z=y.className||y.getAttribute("class");return z?" "+z+" ":z}},c=function(z,y){return r[y]?r[y](z):z[y]!=null?z[y]:z.getAttribute(y)},a=function(A){var z=0,y=A.parentNode,B=y.firstChild;if(e!=y._lixCache){for(;B;B=B.nextSibling){if(B.nodeType==1){B.nodeIndex=++z}}y._lixCache=e}return A.nodeIndex},l={"":function(C,z,y,D){var B=0,E,A=C.getElementsByTagName(z.tag);while(E=A[B++]){v(E,z,D)&&h(y,E)}},"#":function(A,z,y,B){var C=(A.ownerDocument||document).getElementById(z.id);if(C&&C.getAttributeNode("id")&&v(C,z,B)){(z.prev==null||j(A,C))&&h(y,C);throw o}},">":function(D,z,y,E){var C=0,A=1,F,B=D.childNodes||[];while(F=B[C++]){(F.nodeType==1&&v(F,z,E,A++))&&h(y,F)}},"+":function(A,z,y,B){var C=A;while(C=C.nextSibling){if(C.nodeType==1){v(C,z,B)&&h(y,C);break}}},"~":function(A,z,y,B){var C=A;while(C=C.nextSibling){(C.nodeType==1&&v(C,z,B))&&h(y,C)}}},w={":":function(D,C,A){var y=true,B=0,E,z;while(y&&(E=C[B++])){z=g.PSEUDO[E.name];y=z?z(D,E.value):false}return y},".":function(C,B){var A=C.className||C.getAttribute("class"),y=true,z=0,D;if(!A){return false}A=" "+A+" ";while(y&&(D=B[z++])){y=A.indexOf(D)>-1}return y},"[]":function(B,A){var y=true,z=0,C;while(y&&(C=A[z++])){y=g.ATTR[C.expr](c(B,C.name),C.value)}return y}},g={ATTR:{"":function(z,y){return !!z},"=":function(z,y){return z==y},"!=":function(z,y){return z!=y},"~=":function(z,y){return z?(" "+z+" ").indexOf(y)>=0:false},"^=":function(z,y){return z?z.indexOf(y)==0:false},"$=":function(z,y){return z?z.substr(z.length-y.length)==y:false},"*=":function(z,y){return z?z.indexOf(y)>=0:false},"|=":function(z,y){return z?z==y||z.substr(0,y.length+1)==y+"-":false}},PSEUDO:{input:function(y){return/input|select|textarea|button/i.test(y.nodeName)},button:function(y){return"button"==y.type||y.nodeName.toUpperCase()=="BUTTON"},checkbox:function(y){return"checkbox"==y.type},file:function(y){return"file"==y.type},image:function(y){return"image"==y.type},password:function(y){return"password"==y.type},radio:function(y){return"radio"==y.type},reset:function(y){return"reset"==y.type},submit:function(y){return"submit"==y.type},text:function(y){return"text"==y.type},enabled:function(y){return y.disabled==false&&y.type!="hidden"},disabled:function(y){return true},checked:function(y){return y.checked==true},selected:function(y){return y.selected==true},hidden:function(y){return y.offsetWidth==0||y.offsetHeight==0},visible:function(y){return y.offsetWidth>0||y.offsetHeight>0},empty:function(y){return !y.firstChild},parent:function(y){return !!y.firstChild},contains:function(y,z){return(y.textContent||y.innerText||"").indexOf(z)>=0},has:function(B,C){var z=true,A=0,y;while(z&&(y=C[A++])){z=!!(f([B],y,[]).length)}return z},"first-child":function(y){while((y=y.previousSibling)&&y.nodeType!=1){}return !y},"last-child":function(y){while((y=y.nextSibling)&&y.nodeType!=1){}return !y},"only-child":function(z){var y=z;while(y=y.previousSibling){if(y.nodeType==1){return false}}y=z;while(y=y.nextSibling){if(y.nodeType==1){return false}}return true},"nth-child":function(z,A,y){var B=(y||a(z))-A.b;if(A.a==0){return B==0}else{return(B%A.a==0&&B/A.a>=0)}},"gth-child":function(z,A,y){return A<(y||a(z))},"lth-child":function(z,A,y){return A>(y||a(z))},header:function(y){return/h\d/i.test(y.nodeName)},not:function(C,D,A){var z=true,B=0,y;while(z&&(y=D[B++])){z=!v(C,y,y.tag=="*",A)}return z}}};i.PSEUDO.has=i.PSEUDO.not;u.$break=o,u.parse=p,u.parser={attr:i.ATTR,pseudo:i.PSEUDO},u.attr={map:q,handle:r},u.probe={attr:g.ATTR,pseudo:g.PSEUDO}})();