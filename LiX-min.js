/*
 * LiX JavaScript CSS selector engine
 * Project since: 2009-02-18
 * Version: 1.0.4 build 20090706
 * 
 * Copyright (c) 2009 Shen Junru
 * Released under the MIT, BSD, and GPL Licenses.
*/
(function(){var h=function(){this.prev=null;this.next=null;this.group=0;this.tag="*";this.id="";this.type="";this.feature={}},n={CHAR:/^\s*([>~+#\*\w\u00c0-\uFFFF_\-.:\[,])/,SPLIT:/^\s*,\s*/,TAG:/^\s*(\*|[\w\u00c0-\uFFFF_-]+)/,ID:/^(\s*)#(\*|[\w\u00c0-\uFFFF_-]+)/,FILTER:/^\s*([>~+])\s*(\*|[\w\u00c0-\uFFFF_-]+)/,CLASS:/^(\s*)\.([\w\d\u00C0-\uFFFF_-]+)/,PSEUDO:/^\s*:(\w[\w\-]*)(?:\((?:(['"])(.+)\2|([^\)]+\(.+\))|([^\)]+))\))?/,ATTR:/^\s*\[\s*([\w\d]+)\s*(?:([!~$|*^]?=)\s*([\w\d\-\.\u00C0-\uFFFF]+|"([^"]*)"|'([^']*)')\s*)?\]/,NTH:/(-?)(\d*)n((?:\+|-)?\d*)/},s={},r=function(z){return new SyntaxError("css parse error, char:"+z)},c={".":function(B,z,A){B.feature["."]=B.feature["."]||[];B.feature["."].push(z[2])},":":function(F,A,B){try{F.feature[":"]=F.feature[":"]||[];var z=A[1].toLowerCase(),C=A[5]||A[4]||A[3],E=j[":"][z];if(C&&E){C=E(C)}F.feature[":"].push({name:z,value:C})}catch(D){if(D!=s){throw r(B)}}},"[]":function(G,A,B){try{G.feature["[]"]=G.feature["[]"]||[];var z=A[1],E=A[2]||"",C=A[5]||A[4]||A[3],F=j["[]"][z];if(C&&F){C=F(E,C)}G.feature["[]"].push({name:z,expr:E,value:C,target:null})}catch(D){if(D!=s){throw r(B)}}}},j={":":{not:function(E){var z={feature:{}},D=0,A=E.length,F,C,B;while(D<A){F=E.slice(D,A),C=n.CHAR.exec(F);if(!C){break}switch(C[1]){case".":B=n.CLASS.exec(F);if(B){c["."](z,B)}break;case":":B=n.PSEUDO.exec(F);if(B){c[":"](z,B)}break;case"[":B=n.ATTR.exec(F);if(B){c["[]"](z,B)}break}D+=(B?B[0]:F).length}return z},"nth-child":function(A){if(/^\bn\b$/i.test(A)){throw s}var z=n.NTH.exec(A=="even"&&"2n"||A=="odd"&&"2n+1"||!/\D/.test(A)&&"0n+"+A||A);return{a:(z[1]+(z[2]||1))-0,b:z[3]-0}}},"[]":{"class":function(A,z){if(!z){return z}switch(A){case"*=":return z;case"|=":case"^=":return" "+z;case"$=":return z+" ";default:return" "+z+" "}}}},t=function(E){var J=[],C=0,B=0,A=E.length,z=true,G,I,F,H,D;while(B<A){G=E.slice(B,A),I=n.CHAR.exec(G);if(!I){throw r(B)}H=new h(),H._fragroup=C;switch(I[1]){case">":case"~":case"+":F=n.FILTER.exec(G);if(F){H.type=F[1],H.tag=F[2];if(D){D.next=H,H.prev=D}}break;case"#":F=n.ID.exec(G);if(F){if(!F[1]){H=D||H}H.type="#",H.id=F[2];if(F[1]&&D){D.next=H,H.prev=D}}break;case".":F=n.CLASS.exec(G);if(F){if(F[1]&&D){D.next=H,H.prev=D}else{H=D||H}c["."](H,F,B)}break;case":":F=n.PSEUDO.exec(G);if(F){H=D||H,c[":"](H,F,B)}break;case"[":F=n.ATTR.exec(G);if(F){H=D||H,c["[]"](H,F,B)}break;case",":F=n.SPLIT.exec(G);if(F){z=true,C++,D=H=null}break;default:F=n.TAG.exec(G);if(F){H.tag=F[1];if(D){D.next=H,H.prev=D}}break}if(!F){throw r(B)}B+=F[0].length;if(z&&(D||H)){J.push(D||H),z=false}D=H}return J};if(!document.nodeType){document.nodeType=9}var w=window.LiX=function(B,D){D=[D||document];var A=[];if(typeof(B)=="string"&&v(D[0])){try{e=0,y++;var z=t(B),C=0,F;while(F=z[C++]){f(A,F,D)}}catch(E){throw E}}return A},e=0,y=0,f=function(H,G,A){var C=G.next;if(C){var E=[],B=0;G.next=null;arguments.callee(E,G,A);E.lenght==0||arguments.callee(H,C,E);G.next=C}else{if(!A.length){A=document}var B=0,F,z=p(G,A);e++;try{while(F=z[B++]){if(F.nodeType){o[G.type](H,G,F)}}}catch(D){if(D!=s){throw D}}}},i=function(z,A){if(y!=A._lixIndex){A._lixIndex=y,z.push(A)}},q=function(A,z){return A.tag=="*"?true:z.nodeName.toLowerCase()==A.tag.toLowerCase()},x=function(D,B,A){var C,z=true;for(C in D.feature){if(!z){break}z=l[C](B,D.feature[C],A)}return z},k={"class":"className","for":"htmlFor",id:"id"},b=function(z){return z.nodeType==9&&z.documentElement.nodeName!="HTML"||!!z.ownerDocument&&z.ownerDocument.documentElement.nodeName!="HTML"},v=function(z){return(z&&(z.nodeType==1||z.nodeType==9))},m=(function(){if(document.documentElement.compareDocumentPosition){return function(z,A){return(z.compareDocumentPosition(A)&16)==16}}if(document.documentElement.contains){return function(z,A){return z.contains(A)&&z!=A}}return function(z,A){while(A=A.parentNode){if(A==z){return true}}return false}})(),a=function(B){var A=0,z=B.parentNode,C=z.firstChild;if(e!=z._lixCache){for(;C;C=C.nextSibling){if(C.nodeType==1){C.nodeIndex=++A}}z._lixCache=e}return B.nodeIndex},p=function(E,C){var D,A,B=0,z=[];switch(E.type){case"~":while(D=C[B++]){if(D.nodeType){z.push(D);break}}while(A=D,D=C[B++]){if(m(A,D)){z.push(D)}}return z;case"":while(D=C[B++]){if(D.nodeType){z.push(D);break}}while(A=D,D=C[B++]){if(m(D,A)){z=[D]}else{if(!m(A,D)){z.push(D)}}}return z;default:return C}},d=function(A,z){if(z in k){return A[k[z]]}return A.getAttribute(z)},u=function(z,A){var B=d(A,z.name);switch(z.name){case"class":z.target=B?" "+B+" ":null;break;default:z.target=B}return z},o={"":function(z,E,C){var B=0,D,A=C.getElementsByTagName(E.tag)||[];while(D=A[B++]){if(x(E,D,null)){i(z,D)}}},"#":function(z,C,A){var B=(A.ownerDocument||document).getElementById(C.id);if(B&&B.getAttributeNode("id")&&q(C,B)&&x(C,B,null)){if(C.prev==null||m(A,B)){i(z,B)}throw s}},">":function(z,F,D){var C=0,A=1,E,B=D.childNodes||[];while(E=B[C++]){if(E.nodeType==1&&q(F,E)&&x(F,E,A++)){i(z,E)}}},"+":function(z,C,A){var B=A;while(B=B.nextSibling){if(B.nodeType==1){if(q(C,B)&&x(C,B,null)){i(z,B)}break}}},"~":function(z,C,A){var B=A;while(B=B.nextSibling){if(B.nodeType==1&&q(C,B)&&x(C,B,null)){i(z,B)}}}},l={":":function(D,E,B){var z=true,C=0,F;while(z&&(F=E[C++])){var A=g.PSEUDO[F.name.toLowerCase()];z=A?A(D,F.value,B):false}return z},".":function(D,E,A){if(!D.className){return false}var z=true,C=0,F,B=" "+D.className+" ";while(z&&(F=E[C++])){z=B.indexOf(F)>-1}return z},"[]":function(D,E,B){var A=true,C=0,z;while(A&&(z=E[C++])){z=u(z,D);A=g.ATTR[z.expr](z.target,z.value)}return A}},g={ATTR:{"":function(A,z){return !!A},"=":function(A,z){return A==z},"!=":function(A,z){return A!=z},"~=":function(A,z){return A?(" "+A+" ").indexOf(z)>=0:false},"^=":function(A,z){return A?A.indexOf(z)==0:false},"$=":function(A,z){return A?A.substr(A.length-z.length)==z:false},"*=":function(A,z){return A?A.indexOf(z)>=0:false},"|=":function(A,z){return A?A==z||A.substr(0,z.length+1)==z+"-":false}},PSEUDO:{button:function(z){return"button"==z.type||z.nodeName.toUpperCase()=="BUTTON"},checkbox:function(z){return"checkbox"==z.type},file:function(z){return"file"==z.type},image:function(z){return"image"==z.type},input:function(z){return/input|select|textarea|button/i.test(z.nodeName)},password:function(z){return"password"==z.type},radio:function(z){return"radio"==z.type},reset:function(z){return"reset"==z.type},submit:function(z){return"submit"==z.type},text:function(z){return"text"==z.type},enabled:function(z){return z.disabled==false&&z.type!="hidden"},disabled:function(z){return true},checked:function(z){return z.checked==true},selected:function(z){return z.selected==true},hidden:function(z){return z.offsetWidth==0||z.offsetHeight==0},visible:function(z){return z.offsetWidth>0||z.offsetHeight>0},empty:function(z){return !z.firstChild},parent:function(z){return !!z.firstChild},contains:function(z,A){return(z.textContent||z.innerText||"").indexOf(A)>=0},has:function(z,A){return !!(new w(A,z)).length},"first-child":function(z){while((z=z.previousSibling)&&z.nodeType!=1){}return !z},"last-child":function(z){while((z=z.nextSibling)&&z.nodeType!=1){}return !z},"only-child":function(A){var z=A;while(z=z.previousSibling){if(z.nodeType==1){return false}}z=A;while(z=z.nextSibling){if(z.nodeType==1){return false}}return true},"nth-child":function(A,B,z){var C=(z||a(A))-B.b;if(B.a==0){return C==0}else{return(C%B.a==0&&C/B.a>=0)}},"gth-child":function(A,B,z){return B<(z||a(A))},"lth-child":function(A,B,z){return B>(z||a(A))},header:function(z){return/h\d/i.test(z.nodeName)},not:function(A,B,z){return !x(B,A,z)}}};w.parseCSS=t})();