/*
 * LiX JavaScript CSS selector engine
 * Project since: 2009-02-18
 * Version: 1.0.6.1 build 20090807
 * 
 * Copyright (c) 2009 Shen Junru (XFSN)
 * Released under the MIT, BSD, and GPL Licenses.
*/
(function(){if(!document.nodeType){document.nodeType=9}var l={CHAR:/^\s*([>~+#*.:[,\w\u00c0-\uFFFF])/,GROUP:/^\s*,\s*/,TAG:/^\s*(\*|[\w\u00c0-\uFFFF-]+)/,ID:/^(\s*)#([\w\u00c0-\uFFFF-]+)/,FILTER:/^\s*([>~+])\s*(\*|[\w\u00c0-\uFFFF-]+)/,CLASS:/^(\s*)\.([\w\d\u00C0-\uFFFF-]+)/,PSEUDO:/^\s*:([\w\u00c0-\uFFFF-]+)(?:\((?:(['"])(.+)\2|([^\)]+\(.+\))|([^\)]+))\))?/,ATTR:/^\s*\[\s*([\w\u00c0-\uFFFF-]+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3)?\s*\]/,NTH:/(-?)(\d*)n((?:\+|-)?\d*)/},p={},r={"class":"className","for":"htmlFor"},o=function(z,A){return A&&A instanceof SyntaxError?A:new SyntaxError("css parse error, char:"+z)},q=function(B,E){E=E||0;var K=[],z=true,G=B.replace(/\s*$/,""),C=0,D=0,A=G.length,J,H,I,F;while(C<A){G=B.slice(C,A),J=l.CHAR.exec(G);if(!J){throw o(E)}I={tag:"*",type:"",feature:{},group:D};switch(J[1]){case">":case"~":case"+":H=l.FILTER.exec(G);if(H){I.type=H[1],I.tag=H[2];if(F){F.next=I,I.prev=F}}break;case"#":H=l.ID.exec(G);if(H){if(!H[1]){I=F||I}I.type="#",I.id=H[2];if(H[1]&&F){F.next=I,I.prev=F}}break;case".":H=l.CLASS.exec(G);if(H){if(H[1]&&F){F.next=I,I.prev=F}else{I=F||I}n.CLASS(I,H,E)}break;case":":H=l.PSEUDO.exec(G);if(H){I=F||I,n.PSEUDO(I,H,E)}break;case"[":H=l.ATTR.exec(G);if(H){I=F||I,n.ATTR(I,H,E)}break;case",":H=l.GROUP.exec(G);if(H){z=true,D++,F=I=null}break;default:H=l.TAG.exec(G);if(H){I.tag=H[1];if(F){F.next=I,I.prev=F}}break}if(!H){throw o(E)}C+=H[0].length,E+=H[0].length;if(z&&(F||I)){K.push(F||I),z=false}F=I}return K},n={CLASS:function(B,z,A){B.feature["."]=B.feature["."]||[];B.feature["."].push(z[2])},PSEUDO:function(F,A,B){try{var z=A[1].toLowerCase(),C=A[5]||A[4]||A[3],E=i.PSEUDO[z];if(C&&E){C=E(C,z.length+B+2)}(F.feature[":"]||(F.feature[":"]=[])).push({name:z,value:C})}catch(D){if(D!=p){throw o(B,D)}}},ATTR:function(G,A,B){try{var z=A[1],E=A[2]||"",C=A[4],F=i.ATTR[z];if(C&&F){C=F(E,C,B)}(G.feature["[]"]||(G.feature["[]"]=[])).push({name:r[z]||z,expr:E,value:C})}catch(D){if(D!=p){throw o(B,D)}}}},i={PSEUDO:{not:function(z,A){return q(z,A)},"nth-child":function(A){if(/^\bn\b$/i.test(A)){throw p}var z=l.NTH.exec(A=="even"&&"2n"||A=="odd"&&"2n+1"||!/\D/.test(A)&&"0n+"+A||A);return{a:(z[1]+(z[2]||1))-0,b:z[3]-0}}},ATTR:{"class":function(A,z){if(!z){return z}switch(A){case"*=":return z;case"|=":case"^=":return" "+z;case"$=":return z+" ";default:return" "+z+" "}}}},v=window.LiX=function(B,D,A){D=[D||document];A?A.length==null&&(A.length=0):A=[];if(typeof(B)=="string"&&t(D[0])){try{e=0,y++;var z=q(B),C=0,F;while(F=z[C++]){f(D,F,A)}}catch(E){throw E}}return A},e=0,y=0,f=function(C,B,H){var E=B.next;if(E){B.next=null;var G=arguments.callee(C,B,[]);G.lenght||arguments.callee(G,E,H);B.next=E}else{e++;var C=u(C,B),A=B.tag=="*"||B.type=="",D=0,z;try{while(z=C[D++]){if(z.nodeType){m[B.type](z,B,H||[],A)}}}catch(F){if(F!=p){throw F}}}return H},h=function(z,A){if(y!=A._lixIndex){A._lixIndex=y;Array.prototype.push.call(z,A)}},d=function(A,z){return A.nodeName.toLowerCase()==z.tag.toLowerCase()},w=function(D,A,C,B){var z=C||d(D,A),E;for(E in A.feature){if(!z){break}z=x[E](D,A.feature[E],B)}return z},t=function(z){return(z&&(z.nodeType==1||z.nodeType==9))},b=function(z){return z.nodeType==9&&z.documentElement.nodeName!="HTML"||!!z.ownerDocument&&z.ownerDocument.documentElement.nodeName!="HTML"},k=(function(){if(document.documentElement.compareDocumentPosition){return function(A,z){return(A.compareDocumentPosition(z)&16)==16}}if(document.documentElement.contains){return function(A,z){return A.contains(z)&&A!=z}}return function(A,z){while(z=z.parentNode){if(z==A){return true}}return false}})(),u=function(E,A){var D,B,C=0,z=[];switch(A.type){case"~":while(D=E[C++]){if(D.nodeType){z.push(D);break}}while(B=D,D=E[C++]){if(k(B,D)){z.push(D)}}return z;case"":case".":while(D=E[C++]){if(D.nodeType){z.push(D);break}}while(B=D,D=E[C++]){if(k(D,B)){z=[D]}else{if(!k(B,D)){z.push(D)}}}return z;default:return E}},s={href:function(z){return z.getAttribute("href",2)},src:function(z){return z.getAttribute("src",2)},className:function(z){var A=z.className||z.getAttribute("class");return A?" "+A+" ":A}},c=function(A,z){return s[z]?s[z](A):A[z]!=null?A[z]:A.getAttribute(z)},a=function(B){var A=0,z=B.parentNode,C=z.firstChild;if(e!=z._lixCache){for(;C;C=C.nextSibling){if(C.nodeType==1){C.nodeIndex=++A}}z._lixCache=e}return B.nodeIndex},m={"":function(D,A,z,E){var C=0,F,B=D.getElementsByTagName(A.tag);while(F=B[C++]){w(F,A,E)&&h(z,F)}},"#":function(B,A,z,C){var D=(B.ownerDocument||document).getElementById(A.id);if(D&&D.getAttributeNode("id")&&w(D,A,C)){(A.prev==null||k(B,D))&&h(z,D);throw p}},">":function(E,A,z,F){var D=0,B=1,G,C=E.childNodes||[];while(G=C[D++]){(G.nodeType==1&&w(G,A,F,B++))&&h(z,G)}},"+":function(B,A,z,C){var D=B;while(D=D.nextSibling){if(D.nodeType==1){w(D,A,C)&&h(z,D);break}}},"~":function(B,A,z,C){var D=B;while(D=D.nextSibling){(D.nodeType==1&&w(D,A,C))&&h(z,D)}},".":function(D,A,z,E){if(typeof(D.getElementsByClassName)=="function"){var B=D.getElementsByClassName(A["."].join(" ")),C=0,F;while(F=B[C++]){w(F,A,E)&&h(z,F)}}else{A.feature["."]=A["."];m[""](D,A,z,E);A["."]=A.feature["."]}}},j=function(){return false},x={":":function(D,C,A){var z=true,B=0,E;while(z&&(E=C[B++])){z=(g.PSEUDO[E.name]||j)(D,E.value)}return z},".":function(D,C){var B=D.className||D.getAttribute("class"),z=true,A=0,E;if(!B){return false}B=" "+B+" ";while(z&&(E=C[A++])){z=B.indexOf(E)>-1}return z},"[]":function(C,B){var z=true,A=0,D;while(z&&(D=B[A++])){z=(g.ATTR[D.expr]||j)(c(C,D.name),D.value)}return z}},g={ATTR:{"":function(A,z){return !!A},"=":function(A,z){return A==z},"!=":function(A,z){return A!=z},"~=":function(A,z){return A?(" "+A+" ").indexOf(z)>=0:false},"^=":function(A,z){return A?A.indexOf(z)==0:false},"$=":function(A,z){return A?A.substr(A.length-z.length)==z:false},"*=":function(A,z){return A?A.indexOf(z)>=0:false},"|=":function(A,z){return A?A==z||A.substr(0,z.length+1)==z+"-":false}},PSEUDO:{input:function(z){return/input|select|textarea|button/i.test(z.nodeName)},button:function(z){return"button"==z.type||z.nodeName.toUpperCase()=="BUTTON"},checkbox:function(z){return"checkbox"==z.type},file:function(z){return"file"==z.type},image:function(z){return"image"==z.type},password:function(z){return"password"==z.type},radio:function(z){return"radio"==z.type},reset:function(z){return"reset"==z.type},submit:function(z){return"submit"==z.type},text:function(z){return"text"==z.type},enabled:function(z){return z.disabled==false&&z.type!="hidden"},disabled:function(z){return true},checked:function(z){return z.checked==true},selected:function(z){return z.selected==true},hidden:function(z){return z.offsetWidth==0||z.offsetHeight==0},visible:function(z){return z.offsetWidth>0||z.offsetHeight>0},empty:function(z){return !z.firstChild},parent:function(z){return !!z.firstChild},contains:function(z,A){return(z.textContent||z.innerText||"").indexOf(A)>=0},has:function(C,D){var A=true,B=0,z;while(A&&(z=D[B++])){A=!!(f([C],z,[]).length)}return A},"first-child":function(z){while((z=z.previousSibling)&&z.nodeType!=1){}return !z},"last-child":function(z){while((z=z.nextSibling)&&z.nodeType!=1){}return !z},"only-child":function(A){var z=A;while(z=z.previousSibling){if(z.nodeType==1){return false}}z=A;while(z=z.nextSibling){if(z.nodeType==1){return false}}return true},"nth-child":function(A,B,z){var C=(z||a(A))-B.b;if(B.a==0){return C==0}else{return(C%B.a==0&&C/B.a>=0)}},"gth-child":function(A,B,z){return B<(z||a(A))},"lth-child":function(A,B,z){return B>(z||a(A))},header:function(z){return/h\d/i.test(z.nodeName)},not:function(D,E,B){var A=true,C=0,z;while(A&&(z=E[C++])){if(z.type=="."){z.type="",z.feature["."]=z["."]}A=!w(D,z,z.tag=="*",B)}return A}}};if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var z=document.createElement("p");z.innerHTML='<a class="test e"></a><a class="test"></a>';if(z.getElementsByClassName("test e").length==0){return}z.lastChild.className="e";if(z.getElementsByClassName("e").length==1){return}n.CLASS=function(C,A,B){if(C.type){C.feature["."]=C.feature["."]||[];C.feature["."].push(A[2])}else{C.type=".";C["."]=C["."]||[];C["."].push(A[2])}};z=null})()}i.PSEUDO.has=i.PSEUDO.not;v.$break=p,v.syntaxErr=o,v.parse=q,v.index=function(){return y},v.cache=function(){return e},v.match=function(z,D,C){v(z,C);var A=[],B=0;for(;B<D.length;B++){y==D[B]._lixIndex&&A.push(D[B])}return A},v.attr={map:r,handle:s,parser:i.ATTR,probe:g.ATTR},v.pseudo={parser:i.PSEUDO,probe:g.PSEUDO}})();